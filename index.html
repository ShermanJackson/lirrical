<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lirrical: AI Song Lyrics, Song Titles & Cover Art Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <script src="lucide.min.js"></script>
    <link rel="icon" type="images/favicon.png" href="images/favicon.png">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A; 
            color: #E0E0E0; 
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px; 
            margin: 0 auto;
            padding: 20px;
            flex-grow: 1; 
        }

        .text-gradient-blue-purple {
            background-image: linear-gradient(to right, #60A5FA, #A78BFA);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Hero Section Styles */
        .hero-section {
            display: flex;
            flex-direction: column; 
            align-items: center; 
            text-align: center; 
            padding: 4rem 0; 
        }
      
#heroLogoImage {
    display: block; /* Keep this as block */
    max-width: 100%;
    height: auto;
    margin-left: auto;   /* <-- UNCOMMENT OR ADD THIS LINE */
    margin-right: auto;  /* <-- UNCOMMENT OR ADD THIS LINE */
    /* Adjust max-height or a specific width/height if needed */
    /* e.g., max-height: 80px; */
}

/*
   The .hero-welcome-text CSS can remain as it was,
   though the 'text-align: center;' on it won't be what's centering
   this specific block-level image anymore, but it doesn't hurt to keep.
*/
.hero-welcome-text {
    line-height: normal;
    margin-bottom: 1rem;
    text-align: center; /* This is fine to keep, might affect other future inline content */
}

@media (min-width: 768px) {
    .hero-welcome-text {
        text-align: center; /* Fine to keep */
    }
    /* You might want to define a different max-height for the logo on larger screens */
    /* #heroLogoImage { */
    /* max-height: 100px; */
    /* } */
}
        .hero-subtext { 
            font-size: 1rem; 
            font-weight: 500;
            color: #A0A7B3; 
            line-height: 1.6;
            max-width: 600px; 
            margin: 0 auto; 
        }


        .main-card {
            background-color: #000000; 
            border: 1px solid #2A2A2E; 
            border-radius: 16px; 
            padding: 28px 32px; 
            margin-bottom: 30px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5), 0 20px 40px -10px rgba(0,0,0,0.7); 
        }

        .input-field { 
            background-color: rgba(30, 30, 33, 0.9); 
            color: #E0E0E0;
            border: 1px solid #374151; 
            border-radius: 4px; 
            padding: 14px 18px; 
            width: 100%;
            transition: border-color 0.3s, box-shadow 0.3s;
            font-size: 1rem;
            text-align: left; 
        }
        .select-field { 
            background-color: rgba(0, 0, 0, 0.7); 
            color: #E0E0E0;
            border: 1px solid rgba(255, 255, 255, 0.15); 
            border-radius: 4px; 
            padding: 14px 18px; 
            width: 100%;
            transition: border-color 0.3s, box-shadow 0.3s;
            font-size: 1rem;
            appearance: none; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23A0A7B3' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }

        .input-field::placeholder {
            color: #787f8a;
        }
        .input-field:focus, .select-field:focus {
            outline: none;
            border-color: #FF003C; 
            box-shadow: 0 0 0 3px rgba(255, 0, 60, 0.3); 
        }

        .btn-primary {
            background-color: #FF003C; 
            color: white;
            font-weight: 700; 
            padding: 14px 28px; 
            border-radius: 4px; 
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 15px rgba(255, 0, 60, 0.3); 
            display: flex;
            align-items: center;
            justify-content: center; 
            gap: 8px; 
        }
        .btn-primary:hover {
            background-color: #E00034; 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 0, 60, 0.5); 
        }
        .btn-primary:disabled {
            background-image: none; 
            background-color: #2c2c2e;
            color: #666;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
            transform: none;
        }
         .btn-secondary:disabled {
            background-image: none;
            background-color: #1a1a1a; 
            color: #555;
            border-color: #333; 
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: none;
            transform: none;
        }


        .btn-secondary {
            background-color: #000000; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            color: #E0E0E0;
            font-weight: 600; 
            font-size: 0.75rem; 
            padding: 10px 18px; 
            border-radius: 4px; 
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center; 
            gap: 6px; 
            text-align: center; 
            box-shadow: 0 2px 5px rgba(255, 255, 255, 0.05) inset, 0 1px 2px rgba(0,0,0,0.3); 
        }
        .btn-secondary span { 
             line-height: 1.2; 
        }
        .btn-secondary:hover {
            background-color: #111111; 
            border-color: rgba(255, 255, 255, 0.4); 
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1) inset, 0 2px 4px rgba(0,0,0,0.4);
            transform: translateY(-1px);
        }
        .btn-copy-lyrics { 
            background-color: #2A2A2E;
            color: #A0A7B3;
            font-size: 0.75rem; 
            padding: 4px 10px;
            border-radius: 4px; 
            border: 1px solid #374151;
            transition: all 0.2s ease;
            margin-left: 0.5rem; 
        }
        .btn-copy-lyrics:hover {
            background-color: #374151;
            color: #E0E0E0;
        }
        .btn-copy-lyrics.copied {
            background-color: #059669; 
            color: white;
            border-color: #047857;
        }


        .loader { 
            border: 5px solid rgba(55, 65, 81, 0.5); 
            border-top: 5px solid #FF003C; 
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        .small-loader { 
            border: 3px solid rgba(55, 65, 81, 0.7);
            border-top: 3px solid #FF003C; 
            border-radius: 50%;
            width: 28px;
            height: 28px;
            animation: spin 0.8s linear infinite;
            margin: 15px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-title { 
            font-size: 1.75rem; 
            font-weight: 800; 
            margin-bottom: 24px;
            color: #E0E0E0; 
        }
        
        .song-title-list-container { 
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
             gap: 1rem;
             margin-bottom: 1.5rem; 
        }

        .song-title-item { 
            /* No specific styling here, acts as a container */
        }

        .song-title-clickable { 
            background-color: #16181A; 
            color: #E0E0E0;
            padding: 0.85rem 1.25rem; 
            border-radius: 4px; 
            border: 1px solid #2A2A2E;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-weight: 600;
            font-size: 1rem; 
            display: block; 
            width: 100%;
            text-align: left; 
        }
        .song-title-clickable:hover, .song-title-clickable.active {
            background-color: #FF003C;
            color: #FFFFFF;
            border-color: #FF003C;
            transform: scale(1.02); 
        }
        
        .suggestion-detail-content { 
            background-color: #000000; 
            border-width: 0px; 
            border-top: none; 
            border-radius: 0 0 4px 4px; 
            padding: 0; 
            margin-top: -1px; 
            box-shadow: 0 8px 20px -6px rgba(0, 0, 0, 0.5);
            max-height: 0; 
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.5s ease-out, border-width 0.1s ease-out; 
        }
        .suggestion-detail-content.expanded {
            max-height: 1000px; 
            padding: 1.5rem; 
            border: 1px solid #2A2A2E; 
            border-top: none; 
        }


        .suggestion-card { 
            background-color: transparent; 
            border: none; 
            padding: 0; 
            margin-bottom: 0;
            box-shadow: none; 
            text-align: left; 
        }

        .suggestion-title { 
            font-size: 1.25rem; 
            font-weight: 700;
            color: #FFFFFF; 
            margin-bottom: 1rem; 
            text-align: left; 
        }

        .design-tip-section { 
             text-align: left; 
        }
        
        .design-tip-block { 
            display: flex; 
            align-items: flex-start; 
            gap: 6px; 
            margin-top: 12px;
        }
        .design-tip-icon-container {
            flex-shrink: 0; 
            padding-top: 0.1em; 
        }
        .design-tip-text-content {
            flex-grow: 1; 
            text-align: left;
        }

        .design-tip-label-text { 
            font-weight: 600; 
            color: #9CA3AF;
            font-size: 0.95rem;
            display: block; 
            margin-bottom: 2px; 
        }
        .design-tip-value {
            color: #D1D5DB;
            padding-left: 0; 
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .lyrics-section-header { 
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem; 
        }

        .lyrics-section { 
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #374151; 
        }
        .lyrics-content { 
            white-space: pre-wrap;
            background-color: #080808; 
            padding: 16px;
            border-radius: 4px; 
            font-size: 0.75rem; 
            max-height: 350px; 
            overflow-y: auto;
            color: #C0C0C0; 
            border: 1px solid #222225;
            text-align: left; 
        }
        .lyrics-content::-webkit-scrollbar {
            width: 8px;
        }
        .lyrics-content::-webkit-scrollbar-track {
            background: rgba(30, 30, 33, 0.5);
            border-radius: 10px;
        }
        .lyrics-content::-webkit-scrollbar-thumb {
            background: #4B5563;
            border-radius: 10px;
        }
        .lyrics-content::-webkit-scrollbar-thumb:hover {
            background: #FF003C; 
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.85); 
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-panel {
            background-color: #111315; 
            padding: 1.5rem 2rem; 
            border-radius: 8px; 
            border: 1px solid #2A2A2E;
            box-shadow: 0 15px 30px -10px rgba(0,0,0,0.6);
            max-width: 600px; 
            width: 100%;
            max-height: 85vh; 
            display: flex;
            flex-direction: column;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-panel {
            transform: scale(1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem; 
            padding-bottom: 1rem;
            border-bottom: 1px solid #2A2A2E;
        }
        .modal-title {
            font-size: 1.25rem; 
            font-weight: 700;
            color: #E0E0E0;
        }
        .modal-close-btn {
            color: #787F8A;
            background: none;
            border: none;
            padding: 0.5rem; 
            line-height: 1; 
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close-btn svg { 
            width: 24px; 
            height: 24px;
            stroke: currentColor; 
            stroke-width: 2;
        }
        .modal-close-btn:hover {
            color: #FFFFFF;
        }
        .modal-body {
            overflow-y: auto; 
            flex-grow: 1; 
            margin-bottom: 1rem;
        }
        .modal-body .lyrics-content { 
            max-height: none; 
            background-color: #0A0A0C; 
        }
        .modal-footer {
            margin-top: 1rem; 
            padding-top: 1rem;
            border-top: 1px solid #2A2A2E;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .modal-esc-hint {
            font-size: 0.75rem;
            color: #787F8A;
        }
        /* End Modal Styles */


        .error-message {
            background-color: rgba(50, 0, 10, 0.8); 
            color: #FFA0B8; 
            border: 1px solid rgba(100, 0, 20, 0.9);
            padding: 16px; 
            border-radius: 4px; 
            text-align: center;
            margin-top: 24px;
            font-weight: 500;
        }
        .api-key-info {
            font-size: 0.8rem;
            color: #5a5a5e; 
            text-align: center;
            margin-top: 20px; 
            padding: 10px;
            background-color: rgba(20, 20, 22, 0.5);
            border-radius: 4px; 
        }
        .site-footer { 
            text-align: center;
            padding: 1.5rem 1rem;
            font-size: 0.8rem;
            color: #787F8A; 
            margin-top: auto; 
        }


        .lucide-icon {
            width: 1em; 
            height: 1em;
            stroke-width: 2; 
        }
        .lucide-sm { width: 1.1em; height: 1.1em; } 
        .lucide-md { width: 1.3em; height: 1.3em; } 

        .background-shapes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.05; 
        }
        .shape1 {
            width: 400px; height: 400px;
            background: radial-gradient(circle, #60A5FA, transparent 70%);
            top: -100px; left: -150px;
            animation: pulseShape 15s infinite alternate;
        }
        .shape2 {
            width: 500px; height: 500px;
            background: radial-gradient(circle, #A78BFA, transparent 70%);
            bottom: -150px; right: -200px;
            animation: pulseShape 20s infinite alternate-reverse;
        }
         .shape3 {
            width: 300px; height: 300px;
            background: radial-gradient(circle, #FF003C, transparent 60%); 
            top: 20%; right: 5%;
            animation: pulseShape 18s infinite alternate;
        }

        @keyframes pulseShape {
            0% { transform: scale(0.8); opacity: 0.03; }
            100% { transform: scale(1.2); opacity: 0.07; }
        }
        .hidden {
            display: none !important; 
        }

    </style>
</head>
<body>
    <div class="background-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>

    <div class="container py-10 md:py-16">
        <section class="hero-section">
            <div> 
                <h1 class="hero-welcome-text">
                   <img src="images/lirrical_logo.png" alt="LIRRICAL Logo" id="heroLogoImage">
                </h1>
                <p class="hero-subtext">
                    Blazing fast Song Titles, Song Lyrics & Cover Art Ideas
                </p>
            </div>
        </section>
        
        <header class="text-center mb-8 sr-only"> 
            <h1 class="text-5xl md:text-6xl font-black text-gradient-blue-purple">
                Lirrical
            </h1>
            <p class="mt-4 text-lg md:text-xl text-gray-400">AI Song Lyrics, Song Titles & Cover Art Assistant</p>
        </header>

        <div class="main-card">
            <div class="space-y-8"> 
                <div>
                    <label for="genre" class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                        <i data-lucide="music-2" class="lucide-icon lucide-sm"></i>Select Genre:
                    </label>
                    <select id="genre" name="genre" class="select-field">
                        <option value="Hip Hop">Hip Hop</option>
                        <option value="Pop">Pop</option>
                        <option value="Rock">Rock</option>
                        <option value="Electronic">Electronic</option>
                        <option value="Gospel">Gospel</option> 
                        <option value="R&B">R&B / Soul</option>
                        <option value="Folk">Folk / Acoustic</option>
                        <option value="Metal">Metal</option>
                        <option value="Jazz">Jazz</option>
                        <option value="Classical">Classical</option>
                        <option value="Lo-fi">Lo-fi</option>
                        <option value="Ambient">Ambient</option>
                        <option value="Synthwave">Synthwave</option>
                    </select>
                </div>

                <div>
                    <label for="keywords" class="block text-sm font-semibold text-gray-300 mb-2 flex items-center gap-2">
                        <i data-lucide="key-round" class="lucide-icon lucide-sm"></i>Enter Keywords or Lyric Snippet:
                    </label>
                    <input type="text" id="keywords" name="keywords" class="input-field" placeholder="e.g., 'city dreams' or 'stars align tonight'">
                </div>

                <div>
                    <button id="generateButton" class="btn-primary w-full">
                        <i data-lucide="sparkles" class="lucide-icon lucide-md"></i>
                        Get Suggestions
                    </button>
                </div>
            </div>
        </div>

        <div id="loadingIndicator" class="hidden my-10">
            <div class="loader"></div>
            <p class="text-center text-gray-400 font-medium">Mixing up melody and muse...</p>
        </div>

        <div id="errorMessage" class="hidden"></div>

        <div id="resultsArea" class="mt-12">
             </div>
        
        <div class="api-key-info">
            <p>Lirrical uses artificial intelligence to spark your creativity. All lyrics, titles, and ideas are AI-generated and intended for inspiration only. Let your imagination take it from here!</p>
        </div>
    </div>

    <footer class="site-footer">
        <p>In partnership with <a href="https://www.premadepixels.com">PremadePixels.com</a></p>
    </footer>
    <div id="lyricsModal" class="modal-overlay hidden">
        <div class="modal-panel">
            <div class="modal-header">
                <h4 id="modalSongTitle" class="modal-title">Generated Lyrics</h4>
                <button id="closeModalButton" class="modal-close-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="modal-body">
                <div id="modalLyricsLoader" class="hidden my-3"><div class="small-loader"></div></div>
                <div class="lyrics-content" id="modalLyricsText">
                    </div>
            </div>
            <div class="modal-footer">
                <span class="modal-esc-hint">Press ESC to close</span>
                <button id="modalCopyLyricsButton" class="btn-copy-lyrics">
                     <i data-lucide="copy" class="lucide-icon lucide-xs mr-1"></i>Copy
                </button>
            </div>
        </div>
    </div>


    <script>
        let currentSuggestions = []; 

        const genrePlaceholders = {
            "Hip Hop": "e.g., 'street lights', 'empire state', 'broken chains'",
            "Pop": "e.g., 'summer nights', 'heartbeat', 'dance floor'",
            "Rock": "e.g., 'rebel yell', 'highway song', 'electric soul'",
            "Electronic": "e.g., 'neon city', 'future pulse', 'digital dreams'",
            "R&B": "e.g., 'velvet voice', 'late night', 'soul connection'",
            "Folk": "e.g., 'mountain air', 'dusty road', 'campfire stories'",
            "Metal": "e.g., 'iron fist', 'dragon fire', 'eternal conflict'",
            "Jazz": "e.g., 'ivory keys', 'midnight mood', 'smoky lounge'",
            "Classical": "e.g., 'moonlit sonata', 'epic symphony', 'ancient echoes'",
            "Lo-fi": "e.g., 'rainy window', 'study beats', 'chill vibes'",
            "Ambient": "e.g., 'drifting stars', 'ocean depths', 'silent forest'",
            "Synthwave": "e.g., '80s sunset', 'retro future', 'laser grid'",
            "Gospel": "e.g., 'hallelujah praise', 'blessed morning', 'faith journey'",
            "Default": "e.g., 'your theme', 'a cool lyric', 'song idea'" 
        };

        function safeCreateLucideIcons() {
            if (typeof lucide !== 'undefined' && typeof lucide.createIcons === 'function') {
                lucide.createIcons();
            } else {
                console.warn("Lucide library or createIcons function not available at the moment of call.");
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            safeCreateLucideIcons(); 

            const genreSelect = document.getElementById('genre');
            const keywordsInput = document.getElementById('keywords');
            const generateButton = document.getElementById('generateButton');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const resultsArea = document.getElementById('resultsArea');
            const errorMessageDiv = document.getElementById('errorMessage');
            
            const GEMINI_API_KEY = ""; // This remains blank, API key is used by Netlify Function

            const lyricsModal = document.getElementById('lyricsModal');
            const closeModalButton = document.getElementById('closeModalButton');
            const modalSongTitle = document.getElementById('modalSongTitle');
            const modalLyricsLoader = document.getElementById('modalLyricsLoader');
            const modalLyricsText = document.getElementById('modalLyricsText');
            const modalCopyLyricsButton = document.getElementById('modalCopyLyricsButton');

            function updateKeywordPlaceholder() {
                const selectedGenre = genreSelect.value;
                keywordsInput.placeholder = genrePlaceholders[selectedGenre] || genrePlaceholders["Default"];
            }

            updateKeywordPlaceholder();
            genreSelect.addEventListener('change', updateKeywordPlaceholder);
            
            function closeTheModal() {
                if (lyricsModal) { 
                    lyricsModal.classList.add('hidden');
                    lyricsModal.classList.remove('active');
                }
            }

            if(closeModalButton) {
                closeModalButton.addEventListener('click', closeTheModal);
            }
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && lyricsModal && lyricsModal.classList.contains('active')) {
                    closeTheModal();
                }
            });


             if(modalCopyLyricsButton) {
                modalCopyLyricsButton.addEventListener('click', () => handleCopyLyrics(modalCopyLyricsButton, modalLyricsText.id));
            }


            generateButton.addEventListener('click', fetchSuggestions);
            
            async function fetchSuggestions() {
                const genre = genreSelect.value;
                const keywords = keywordsInput.value.trim();

                if (!keywords) {
                    displayError("Hey, musician! Please drop some keywords or a lyric snippet first. 🎶");
                    return;
                }

                generateButton.disabled = true;
                loadingIndicator.classList.remove('hidden');
                resultsArea.innerHTML = ''; 
                errorMessageDiv.classList.add('hidden');
                currentSuggestions = []; 

                const netlifyFunctionUrl = `/.netlify/functions/getLirricalIdeas?genre=${encodeURIComponent(genre)}&keywords=${encodeURIComponent(keywords)}`;
                console.log("Calling Netlify Function for Suggestions:", netlifyFunctionUrl); 

                try {
                    const response = await fetch(netlifyFunctionUrl); 

                    console.log("Netlify Function (Suggestions) Response Status:", response.status); 

                    if (!response.ok) {
                        let errorDetail = `Suggestions API failed (${response.status}).`; 
                        try {
                            const errorData = await response.json(); 
                            errorDetail = errorData.error || errorData.message || `Suggestions API responded with status ${response.status}. Details: ${JSON.stringify(errorData)}`;
                            console.error("Parsed Error from getLirricalIdeas Function:", errorData);
                        } catch (e) {
                            const textError = await response.text();
                            errorDetail += ` Server response: ${textError || response.statusText}`;
                            console.warn("Could not parse error response from getLirricalIdeas function as JSON. Raw text:", textError);
                        }
                        throw new Error(errorDetail);
                    }

                    const suggestionsArray = await response.json(); 
                    console.log("Received suggestions from Netlify function:", suggestionsArray);

                    currentSuggestions = suggestionsArray; 
                    displaySongTitlesList(suggestionsArray); 

                } catch (error) { 
                    console.error("Error in fetchSuggestions (Client Side):", error);
                    displayError(`Bummer! Fetching suggestions failed: ${error.message}`);
                } finally {
                    generateButton.disabled = false;
                    loadingIndicator.classList.add('hidden');
                }
            }

            function displaySongTitlesList(suggestions) {
                resultsArea.innerHTML = ''; 
                if (!suggestions || suggestions.length === 0) {
                    resultsArea.innerHTML = '<p class="text-center text-gray-400 py-8 font-medium">Hmm, no ideas sparked. Try different keywords or a new genre!</p>';
                    return;
                }
                
                const titleHeading = document.createElement('h2');
                titleHeading.className = 'results-title text-center';
                titleHeading.textContent = 'Lirrical Suggestions';
                resultsArea.appendChild(titleHeading);

                const listContainer = document.createElement('div');
                listContainer.className = 'song-title-list-container';

                suggestions.forEach((suggestion, index) => {
                    if (!suggestion.songTitle) return; 

                    const itemWrapper = document.createElement('div');
                    itemWrapper.className = 'song-title-item';

                    const titleCard = document.createElement('div');
                    titleCard.className = 'song-title-clickable';
                    titleCard.textContent = suggestion.songTitle;
                    titleCard.dataset.index = index; 
                    titleCard.addEventListener('click', handleSongTitleClick);
                    
                    const detailContentDiv = document.createElement('div');
                    detailContentDiv.className = 'suggestion-detail-content'; 
                    detailContentDiv.id = `detail-content-${index}`;

                    itemWrapper.appendChild(titleCard);
                    itemWrapper.appendChild(detailContentDiv);
                    listContainer.appendChild(itemWrapper);
                });
                resultsArea.appendChild(listContainer);

                const moreSuggestionsButton = document.createElement('button');
                moreSuggestionsButton.id = 'moreSuggestionsButton';
                moreSuggestionsButton.className = 'btn-primary w-full mt-6'; 
                moreSuggestionsButton.innerHTML = '<i data-lucide="refresh-cw" class="lucide-icon lucide-md"></i> Give me more Song Titles';
                moreSuggestionsButton.addEventListener('click', fetchSuggestions); 
                resultsArea.appendChild(moreSuggestionsButton);

                safeCreateLucideIcons(); 
            }

            function handleSongTitleClick(event) {
                const clickedTitleCard = event.currentTarget;
                const songIndex = parseInt(clickedTitleCard.dataset.index);
                const selectedSuggestion = currentSuggestions[songIndex];
                const detailContentDiv = clickedTitleCard.nextElementSibling; 

                document.querySelectorAll('.suggestion-detail-content.expanded').forEach(expandedDiv => {
                    if (expandedDiv !== detailContentDiv) {
                        expandedDiv.classList.remove('expanded');
                        expandedDiv.innerHTML = ''; 
                    }
                });
                document.querySelectorAll('.song-title-clickable.active').forEach(activeCard => {
                    if (activeCard !== clickedTitleCard) {
                        activeCard.classList.remove('active');
                    }
                });

                if (detailContentDiv.classList.contains('expanded')) {
                    detailContentDiv.classList.remove('expanded');
                    clickedTitleCard.classList.remove('active');
                    detailContentDiv.innerHTML = ''; 
                } else {
                    populateAndExpandDetail(detailContentDiv, selectedSuggestion, genreSelect.value);
                    detailContentDiv.classList.add('expanded');
                    clickedTitleCard.classList.add('active');
                }
            }
            
            function populateAndExpandDetail(detailDiv, suggestion, genre) {
                detailDiv.innerHTML = ''; 

                if (!suggestion || !suggestion.songTitle || !suggestion.albumCoverIdeas) {
                    detailDiv.innerHTML = '<p class="text-red-400 p-4">Could not load details.</p>';
                    return; 
                }
                
                const uniqueId = `sugg-detail-inline-${Date.now()}`; 
                const detailCardInner = document.createElement('div');
                detailCardInner.className = 'suggestion-card'; 

                detailCardInner.innerHTML = `
                    <h3 class="suggestion-title">${suggestion.songTitle}</h3> 
                    <div class="mt-4 space-y-3 design-tip-section"> 
                        <div class="design-tip-block">
                            <div class="design-tip-icon-container"><i data-lucide="palette" class="lucide-icon lucide-sm"></i></div>
                            <div class="design-tip-text-content">
                                <p class="design-tip-label-text">Color Palette:</p>
                                <p class="design-tip-value">${suggestion.albumCoverIdeas.colorPalette || 'N/A'}</p>
                            </div>
                        </div>
                        <div class="design-tip-block">
                            <div class="design-tip-icon-container"><i data-lucide="type" class="lucide-icon lucide-sm"></i></div>
                            <div class="design-tip-text-content">
                                <p class="design-tip-label-text">Typography:</p>
                                <p class="design-tip-value">${suggestion.albumCoverIdeas.typography || 'N/A'}</p>
                            </div>
                        </div>
                        <div class="design-tip-block">
                             <div class="design-tip-icon-container"><i data-lucide="image" class="lucide-icon lucide-sm"></i></div>
                             <div class="design-tip-text-content">
                                <p class="design-tip-label-text">Imagery/Style:</p>
                                <p class="design-tip-value">${suggestion.albumCoverIdeas.imageryStyle || 'N/A'}</p>
                            </div>
                        </div>
                        <div class="design-tip-block">
                            <div class="design-tip-icon-container"><i data-lucide="smile" class="lucide-icon lucide-sm"></i></div>
                            <div class="design-tip-text-content">
                                <p class="design-tip-label-text">Overall Mood:</p>
                                <p class="design-tip-value">${suggestion.albumCoverIdeas.overallMood || 'N/A'}</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-700 space-y-3">
                         <a href="https://premadepixels.com" target="_blank" class="btn-secondary">
                            <i data-lucide="download-cloud" class="lucide-icon lucide-md"></i><span>Find a Cover on PremadePixels</span>
                        </a>
                        <button class="btn-secondary generate-lyrics-btn" 
                                data-songtitle="${suggestion.songTitle}" 
                                data-genre="${genre}" 
                                data-inline-lyrics-target="${uniqueId}-lyrics-content" 
                                data-inline-loader-target="${uniqueId}-lyrics-loader">
                            <i data-lucide="file-text" class="lucide-icon lucide-md"></i><span>Generate Lyrics</span>
                        </button>
                        <div id="${uniqueId}-lyrics-loader" class="hidden my-3"><div class="small-loader"></div></div>
                        <div id="${uniqueId}-lyrics-content" class="lyrics-section hidden">
                            <div class="lyrics-section-header">
                                <p class="design-tip-label-text mb-0 flex items-center"><i data-lucide="mic-2" class="lucide-icon lucide-sm mr-2"></i>Generated Lyrics:</p> 
                                <button class="btn-copy-lyrics" data-lyrics-container-id="${uniqueId}-lyrics-text-inline">
                                    <i data-lucide="copy" class="lucide-icon lucide-xs mr-1"></i>Copy
                                </button>
                            </div>
                            <div class="lyrics-content" id="${uniqueId}-lyrics-text-inline"></div>
                        </div>
                    </div>
                `;
                detailDiv.appendChild(detailCardInner);
                safeCreateLucideIcons(); 
                detailDiv.querySelector('.generate-lyrics-btn').addEventListener('click', handleLyricGenerationClick);
                detailDiv.querySelector('.btn-copy-lyrics').addEventListener('click', (e) => handleCopyLyrics(e.currentTarget, `${uniqueId}-lyrics-text-inline`));
            }
            
            function handleLyricGenerationClick(event) {
                const button = event.currentTarget;
                const songTitle = button.dataset.songtitle;
                const genre = button.dataset.genre; 
                const inlineLyricsTargetId = button.dataset.inlineLyricsTarget;
                const inlineLoaderTargetId = button.dataset.inlineLoaderTarget;
                
                const lyricsTextContainerForModal = document.getElementById('modalLyricsText'); 
                const lyricsLoaderForModal = document.getElementById('modalLyricsLoader'); 

                if (window.innerWidth >= 768) { // Desktop - use modal
                    if (lyricsModal && modalSongTitle && lyricsTextContainerForModal && lyricsLoaderForModal && closeModalButton && modalCopyLyricsButton) {
                        lyricsModal.classList.remove('hidden');
                        lyricsModal.classList.add('active');
                        
                        closeModalButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
                        modalCopyLyricsButton.innerHTML = '<i data-lucide="copy" class="lucide-icon lucide-xs mr-1"></i>Copy';
                        modalCopyLyricsButton.classList.remove('copied'); 

                        requestAnimationFrame(() => { 
                            safeCreateLucideIcons(); 
                        });
                        modalSongTitle.textContent = `Lyrics for: ${songTitle}`;
                        if (lyricsTextContainerForModal) lyricsTextContainerForModal.textContent = ''; 
                        if (lyricsLoaderForModal) lyricsLoaderForModal.classList.remove('hidden');
                        
                        fetchAndDisplayLyrics(songTitle, genre, lyricsTextContainerForModal, lyricsLoaderForModal, button); // Removed 'isModal' as it's implied
                    } else {
                        console.error("Modal elements not found for lyric generation.");
                    }
                } else { // Mobile - use inline
                    const lyricsDiv = document.getElementById(inlineLyricsTargetId); 
                    const loaderDiv = document.getElementById(inlineLoaderTargetId);
                    const lyricsTextContainer = lyricsDiv ? lyricsDiv.querySelector('.lyrics-content') : null;
                    
                    if (lyricsDiv && lyricsTextContainer && loaderDiv) {
                        lyricsDiv.classList.remove('hidden'); 
                        fetchAndDisplayLyrics(songTitle, genre, lyricsTextContainer, loaderDiv, button); // Removed 'isModal'
                    } else {
                         console.error("Inline lyric elements not found.");
                    }
                }
            }

            async function fetchAndDisplayLyrics(songTitle, genre, lyricsTextContainerElement, loaderElement, clickedButton) {
                if(clickedButton) clickedButton.disabled = true;
                if(loaderElement) loaderElement.classList.remove('hidden');
                if(lyricsTextContainerElement) lyricsTextContainerElement.textContent = ''; 

                const netlifyLyricsFunctionUrl = `/.netlify/functions/generateSongLyrics?songTitle=${encodeURIComponent(songTitle)}&genre=${encodeURIComponent(genre)}`;
                console.log("Calling Netlify Function for Lyrics:", netlifyLyricsFunctionUrl);

                try {
                    const response = await fetch(netlifyLyricsFunctionUrl);
                    console.log("Lyrics Function Response Status (from client):", response.status);
                    const lyricsResultText = await response.text(); 

                    if (!response.ok) {
                        let errorDetail = lyricsResultText; // Default to the raw text
                        try {
                            const parsedJsonError = JSON.parse(lyricsResultText); // Try to parse as JSON
                            if (parsedJsonError && parsedJsonError.error) { // If successful and has an error property
                                errorDetail = parsedJsonError.error;
                            }
                        } catch(e) {
                            // Not JSON, or JSON without an 'error' property; 'errorDetail' remains the raw text.
                            console.warn("Response from lyrics function was not a JSON error object, or did not contain an 'error' field. Raw text:", lyricsResultText);
                        }
                        console.error("Error from generateSongLyrics function (client side):", errorDetail);
                        throw new Error(errorDetail || `Lyrics generation failed with status ${response.status}.`);
                    }
                    
                    if (lyricsTextContainerElement) {
                        lyricsTextContainerElement.textContent = lyricsResultText;
                    }

                } catch (error) {
                    console.error("Error fetching lyrics (Client Side Catch Block):", error);
                    const errorMessage = `Oh no! Lyric generation failed: ${error.message}`;
                    if(lyricsTextContainerElement) {
                        lyricsTextContainerElement.textContent = errorMessage;
                    } else if (lyricsModal && lyricsModal.classList.contains('active') && modalLyricsText) { 
                        modalLyricsText.textContent = errorMessage;
                    } else {
                        displayError(`Fetching lyrics failed: ${error.message}`);
                    }
                } finally {
                    if(clickedButton) clickedButton.disabled = false;
                    if(loaderElement) loaderElement.classList.add('hidden');
                }
            }


            function handleCopyLyrics(buttonElement, lyricsContainerId) {
                const lyricsTextContainer = document.getElementById(lyricsContainerId);

                if (lyricsTextContainer && lyricsTextContainer.textContent) {
                    const textToCopy = lyricsTextContainer.textContent;
                    
                    const textArea = document.createElement("textarea");
                    textArea.value = textToCopy;
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        buttonElement.innerHTML = '<i data-lucide="check" class="lucide-icon lucide-xs mr-1"></i>Copied!';
                        buttonElement.classList.add('copied');
                        safeCreateLucideIcons(); 

                        setTimeout(() => {
                            buttonElement.innerHTML = '<i data-lucide="copy" class="lucide-icon lucide-xs mr-1"></i>Copy';
                            buttonElement.classList.remove('copied');
                            safeCreateLucideIcons(); 
                        }, 2000);
                    } catch (err) {
                        console.error('Fallback: Oops, unable to copy', err);
                        buttonElement.textContent = 'Error';
                         setTimeout(() => {
                            buttonElement.innerHTML = '<i data-lucide="copy" class="lucide-icon lucide-xs mr-1"></i>Copy';
                            safeCreateLucideIcons();
                        }, 2000);
                    }
                    document.body.removeChild(textArea);
                } else {
                    console.warn("No lyrics text found to copy for container:", lyricsContainerId);
                }
            }


            function displayError(message) {
                errorMessageDiv.innerHTML = `<div class="error-message flex items-center justify-center gap-2"><i data-lucide="alert-triangle" class="lucide-icon"></i> ${message}</div>`;
                errorMessageDiv.classList.remove('hidden');
                safeCreateLucideIcons(); 
            }

            const styleSheet = document.createElement("style");
            styleSheet.type = "text/css";
            styleSheet.innerText = `
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(10px); } 
                    to { opacity: 1; transform: translateY(0); }
                }
                .suggestion-detail-content.expanded { animation: fadeIn 0.4s ease-out forwards; }
                .modal-overlay.active { animation: fadeIn 0.3s ease-out forwards; }
            `; 
            document.head.appendChild(styleSheet);
        });

        window.addEventListener('load', () => {
            console.log("Window.load event fired. Attempting to initialize/refresh Lucide icons.");
            safeCreateLucideIcons();
        });
    </script>
</body>
</html>
